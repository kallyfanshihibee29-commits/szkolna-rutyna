<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Motywator szkolny ‚Äî Ultra Animacje</title>
  <style>
    :root{
      --bg:#FFFFFF;
      --accent:#BACCAE;
      --accent-2:#9FBDA8;
      --card:#FFFFFF;
      --text:#183925;
      --muted:#6b6b6b;
      --radius:12px;
      --coin:#F2C94C;
      font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
    .app{max-width:980px;margin:12px auto;padding:12px}

    /* header */
    header{display:flex;align-items:center;gap:12px}
    .logo{display:flex;align-items:center;gap:10px}
    .coin-logo{width:52px;height:52px;border-radius:50%;background:linear-gradient(145deg,var(--accent-2),var(--accent));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;box-shadow:0 18px 40px rgba(0,0,0,0.08);transform-origin:center}
    h1{font-size:18px;margin:0}

    .wallet{display:flex;align-items:center;gap:12px;margin-left:auto}
    .wallet-coin{display:inline-flex;align-items:center;justify-content:center;width:34px;height:34px;border-radius:50%;background:linear-gradient(145deg,#ffd66b,#f5b800);box-shadow:0 8px 26px rgba(0,0,0,0.12);font-weight:800;transform-origin:center}

    .tabs{display:flex;gap:8px;margin-top:12px}
    .tab{padding:8px 12px;border-radius:12px;background:rgba(255,255,255,0.98);cursor:pointer;border:1px solid rgba(0,0,0,0.06);font-weight:700;transform-origin:center}
    .tab.active{background:linear-gradient(180deg,var(--accent-2),var(--accent));box-shadow:0 18px 40px rgba(0,0,0,0.08);color:#073018}

    .btn{background:linear-gradient(180deg,var(--accent-2),var(--accent));border:0;color:var(--text);padding:10px 14px;border-radius:16px;cursor:pointer;font-weight:800;box-shadow:0 18px 40px rgba(0,0,0,0.08);transition:transform .16s cubic-bezier(.2,.9,.2,1),box-shadow .16s}
    .btn:hover{transform:translateY(-6px) scale(1.02) rotate(-0.6deg);box-shadow:0 26px 60px rgba(0,0,0,0.12)}
    .btn.secondary{background:linear-gradient(180deg,#fff,#fbfbfb);border:1px solid rgba(0,0,0,0.06)}
    .btn.small{padding:6px 8px;border-radius:12px;font-size:13px}
    .btn.xsmall{padding:6px 8px;border-radius:12px;font-size:12px}

    main{margin-top:14px}
    .panel{background:var(--card);border-radius:var(--radius);padding:20px;box-shadow:0 12px 36px rgba(0,0,0,0.06)}

    .lobby-top{display:flex;gap:12px;align-items:center}
    .stats{flex:1;display:flex;gap:12px;align-items:center}
    .stat-card{flex:1;padding:16px;border-radius:14px;background:linear-gradient(180deg,var(--accent-2),var(--accent));color:#fff;box-shadow:0 22px 46px rgba(0,0,0,0.08);transform-origin:center}
    .stat-card b{display:block;font-size:22px}

    .create-row{display:flex;gap:8px;align-items:center;margin-top:16px}
    .create-row input[type="date"], .create-row input[type="text"]{padding:12px;border-radius:14px;border:1px solid rgba(0,0,0,0.06);background:transparent}
    .create-row .grow{flex:1}

    .quick-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px;margin-top:14px}
    .quick-card{background:#fff;padding:14px;border-radius:14px;border:1px solid rgba(0,0,0,0.06);display:flex;flex-direction:column;gap:8px;box-shadow:0 14px 36px rgba(0,0,0,0.06);transform-origin:center}
    .quick-card .date{font-size:12px;color:var(--muted)}

    form.add-task{display:grid;grid-template-columns:1fr;gap:10px;align-items:center;margin-top:14px}
    .add-row{display:grid;grid-template-columns:1fr auto;gap:8px;align-items:center}
    .time-row{display:flex;gap:10px;margin-top:8px}
    .time-row input{flex:1}

    input,select{padding:12px;border-radius:12px;border:1px solid rgba(0,0,0,0.06);background:transparent}
    .task-list{margin-top:14px;display:flex;flex-direction:column;gap:12px}
    .task{display:flex;align-items:center;gap:14px;padding:14px;border-radius:14px;border:1px solid rgba(0,0,0,0.06);background:#fff;box-shadow:0 14px 36px rgba(0,0,0,0.06);transform-origin:center}
    .task .meta{flex:1}
    .task .meta b{display:block}
    .task .tags{font-size:13px;color:var(--muted);margin-top:6px}

    input[type="checkbox"]{width:20px;height:20px;accent-color:#2f9e66;cursor:pointer}

    .shop-list{display:flex;flex-direction:column;gap:14px}
    .shop-item{display:flex;justify-content:space-between;align-items:center;padding:16px;border-radius:14px;border:1px solid rgba(0,0,0,0.06);background:#fff;transition:transform .24s, box-shadow .24s}
    .shop-item:hover{transform:translateY(-18px) rotate(-2deg) scale(1.02);box-shadow:0 28px 60px rgba(0,0,0,0.12)}

    .history{max-height:420px;overflow:auto;padding-top:8px}
    .history-item{display:flex;justify-content:space-between;align-items:center;padding:12px;border-radius:12px;background:#fff;border:1px solid rgba(0,0,0,0.06);gap:12px;box-shadow:0 12px 30px rgba(0,0,0,0.06);transform-origin:center}
    .history-item .left{flex:1}
    .history-item .name{font-weight:800}
    .history-item .date{font-size:12px;color:var(--muted);margin-top:4px}
    .counts{font-size:13px;color:var(--muted);margin-top:6px}

    .muted{color:var(--muted)}

    /* ULTRA animations: big, dramatic, long and with overshoot */
    @keyframes megaEnter{ 0%{transform:translateY(220px) rotate(-10deg) scale(.8);opacity:0} 60%{transform:translateY(-24px) rotate(4deg) scale(1.08);opacity:1} 85%{transform:translateY(6px) rotate(-1deg) scale(.995)} 100%{transform:translateY(0) rotate(0) scale(1);opacity:1} }
    @keyframes popPulse{ 0%{transform:scale(.92)} 50%{transform:scale(1.06)} 100%{transform:scale(1)} }
    @keyframes floaty{ 0%{transform:translateY(0)} 50%{transform:translateY(-8px) rotate(-1deg)} 100%{transform:translateY(0)} }
    @keyframes wobble{ 0%{transform:rotate(0)}25%{transform:rotate(2deg)}50%{transform:rotate(-2deg)}75%{transform:rotate(1deg)}100%{transform:rotate(0)} }
    @keyframes sparkle{ 0%{filter:brightness(1)}50%{filter:brightness(1.25) saturate(1.1)}100%{filter:brightness(1)} }

    .animate-ultra{animation-name:megaEnter;animation-duration:1.4s;animation-timing-function:cubic-bezier(.16,.9,.2,1);animation-fill-mode:both}
    .pulse-slow{animation:popPulse 1.6s ease-in-out both}
    .floaty{animation:floaty 3.2s ease-in-out infinite}
    .wobble-slow{animation:wobble 1.8s ease-in-out both}
    .sparkle{animation:sparkle 2s ease-in-out infinite}

    /* apply big animations broadly */
    .animate-start{animation:megaEnter 1.4s cubic-bezier(.16,.9,.2,1) both}
    .coin-logo{animation:floaty 3s ease-in-out infinite}
    .wallet-coin{animation:popPulse 1.2s ease-in-out infinite}
    .tab{transition:transform .24s,box-shadow .24s}
    .tab:hover{transform:translateY(-8px) scale(1.03)}
    .tab.active{animation:wobble 1s ease both}
    .stat-card{animation:megaEnter 1.6s cubic-bezier(.16,.9,.2,1) both}
    .quick-card{animation:megaEnter 1.6s cubic-bezier(.16,.9,.2,1) both}
    .task{animation:megaEnter 1.2s cubic-bezier(.16,.9,.2,1) both}
    .shop-item{animation:megaEnter 1.5s cubic-bezier(.16,.9,.2,1) both}
    .history-item{animation:megaEnter 1.4s cubic-bezier(.16,.9,.2,1) both}

    /* intense hover for buttons */
    .btn:active{transform:translateY(2px) scale(.98) rotate(0)}

    @media(max-width:720px){
      .lobby-top{flex-direction:column;align-items:stretch}
      .create-row{flex-direction:column}
      .add-row{grid-template-columns:1fr auto}
      .time-row{flex-direction:column}
      .quick-grid{grid-template-columns:repeat(auto-fit,minmax(160px,1fr))}
    }

  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="logo">
        <div class="coin-logo">üåø</div>
        <div>
          <h1>Motywator szkolny</h1>
          <div style="font-size:12px;color:var(--muted)">Estetycznie ‚Ä¢ Prosto ‚Ä¢ #BACCAE</div>
        </div>
      </div>
      <div class="wallet">
        <div style="font-size:12px;color:var(--muted)">Stan</div>
        <div id="balance" style="font-weight:800;display:flex;align-items:center;gap:8px"><span class="wallet-coin">ü™ô</span><span id="balanceVal">0</span></div>
      </div>
    </header>

    <div class="tabs" role="tablist">
      <div class="tab active" data-tab="lobby">üè† Lobby</div>
      <div class="tab" data-tab="today">üìù Dzie≈Ñ</div>
      <div class="tab" data-tab="shop">üõçÔ∏è Sklep</div>
      <div class="tab" data-tab="history">üìö Historia</div>
    </div>

    <main>
      <!-- LOBBY -->
      <section id="tab-lobby" class="panel" style="display:block">
        <div class="lobby-top">
          <div class="stats">
            <div class="stat-card animate-ultra sparkle">
              <div style="font-size:12px;opacity:0.95">Dni uko≈Ñczone</div>
              <b id="statDays">0</b>
            </div>
            <div class="stat-card animate-ultra sparkle">
              <div style="font-size:12px;opacity:0.95">Monety</div>
              <b id="statCoins">0</b>
            </div>
          </div>
          <div style="margin-left:12px;align-self:flex-start;text-align:right">
            <div class="muted" style="font-size:12px">Data</div>
            <div id="currentDateLobby" style="font-weight:700"></div>
          </div>
        </div>

        <div class="create-row">
          <input type="date" id="newDayDate" />
          <input type="text" id="newDayName" placeholder="Nazwa dnia (np. Test z matmy)" class="grow" />
          <button type="button" class="btn" id="createNewDay">Utw√≥rz dzie≈Ñ</button>
        </div>

        <div style="margin-top:14px;font-weight:700">Ostatnie dni</div>
        <div class="quick-grid" id="quickDays"></div>
      </section>

      <!-- TODAY / Day editor -->
      <section id="tab-today" class="panel" style="display:none">
        <div style="display:flex;flex-direction:column;gap:10px">
          <div>
            <div style="font-weight:800" id="dayHeaderName">(nie wybrano)</div>
            <div id="openDayLabel" class="muted" style="margin-top:6px">(data)</div>
          </div>

          <!-- reduced buttons under the name, user requested smaller -->
          <div style="display:flex;gap:8px;align-items:center">
            <button type="button" class="btn xsmall" id="saveDayState">Zapisz</button>
            <button type="button" class="btn xsmall" id="lockList">Zako≈Ñcz listƒô</button>
            <button type="button" class="btn xsmall" id="finishDay">Zako≈Ñcz dzie≈Ñ</button>
          </div>
        </div>

        <form class="add-task" id="taskForm">
          <input id="title" placeholder="Tytu≈Ç zadania" required />

          <div class="add-row">
            <select id="category">
              <option value="nauka">üìö Nauka (3 monet/godz)</option>
              <option value="sprzatanie">üßπ SprzƒÖtanie (2 monety)</option>
              <option value="poranna">üåÖ Poranna rutyna (1 moneta)</option>
              <option value="czas_wolny">üéÆ Czas wolny (1 moneta)</option>
              <option value="inne">üîñ Inne (0 monet)</option>
            </select>
            <button type="submit" class="btn small" id="addTaskBtn" title="Dodaj">‚ûï</button>
          </div>

          <div class="time-row">
            <input type="time" id="start" required />
            <input type="time" id="end" required />
          </div>
        </form>

        <div class="task-list" id="tasksArea" style="margin-top:12px"></div>
      </section>

      <!-- SHOP -->
      <section id="tab-shop" class="panel" style="display:none">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="font-weight:700">Sklep</div>
          <div class="muted" style="font-size:13px">Wydawaj monety na nagrody</div>
        </div>

        <div style="margin-top:12px" class="shop-list" id="shopList"></div>

        <div style="margin-top:12px;font-weight:700">Historia zakup√≥w</div>
        <div id="purchases" style="margin-top:8px;max-height:220px;overflow:auto"></div>
      </section>

      <!-- HISTORY -->
      <section id="tab-history" class="panel" style="display:none">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="font-weight:700">Historia list</div>
          <div class="muted" style="font-size:13px"><span id="completedDaysCount">0</span> dni uko≈Ñczonych</div>
        </div>
        <div class="history" id="history"></div>
      </section>

    </main>

    <footer>Stworzono z my≈õlƒÖ o koncentracji ‚Äî prostota i #BACCAE</footer>
  </div>

  <script>
    // storage keys
    const LS = {DAYS:'motywator_days_v1', BAL:'motywator_balance_v1', PUR:'motywator_purchases_v1'};
    const isoDate = d=>d.toISOString().slice(0,10);

    // helpers
    const loadObj = k => JSON.parse(localStorage.getItem(k)||'{}');
    const loadArr = k => JSON.parse(localStorage.getItem(k)||'[]');
    const save = (k,v)=>localStorage.setItem(k,JSON.stringify(v));

    // data
    let days = loadObj(LS.DAYS);
    let balance = Number(localStorage.getItem(LS.BAL) || 0);
    let purchases = loadArr(LS.PUR);

    // migrate older entries (ensure id + created fields)
    (function migrate(){
      let changed = false;
      Object.keys(days).forEach(k=>{
        const d = days[k];
        if(!d) return;
        if(!d.id){ d.id = k; changed = true; }
        if(!d.created) d.created = Date.now();
      });
      if(changed) save(LS.DAYS,days);
    })();

    let currentOpenKey = null;

    // UI refs
    const tabs = document.querySelectorAll('.tab');
    const sections = {lobby:document.getElementById('tab-lobby'), today:document.getElementById('tab-today'), shop:document.getElementById('tab-shop'), history:document.getElementById('tab-history')};
    const dayHeaderName = document.getElementById('dayHeaderName');
    const openDayLabel = document.getElementById('openDayLabel');
    const tasksArea = document.getElementById('tasksArea');
    const taskForm = document.getElementById('taskForm');
    const titleIn = document.getElementById('title');
    const startIn = document.getElementById('start');
    const endIn = document.getElementById('end');
    const catIn = document.getElementById('category');
    const lockListBtn = document.getElementById('lockList');
    const finishDayBtn = document.getElementById('finishDay');
    const saveDayStateBtn = document.getElementById('saveDayState');
    const balanceValEl = document.getElementById('balanceVal');
    const historyEl = document.getElementById('history');
    const quickDays = document.getElementById('quickDays');
    const statDaysEl = document.getElementById('statDays');
    const statCoinsEl = document.getElementById('statCoins');
    const shopList = document.getElementById('shopList');
    const purchasesEl = document.getElementById('purchases');
    const newDayDate = document.getElementById('newDayDate');
    const newDayName = document.getElementById('newDayName');
    const createNewDayBtn = document.getElementById('createNewDay');

    // defaults
    const todayKey = isoDate(new Date());
    if(newDayDate) newDayDate.value = todayKey;
    balanceValEl.textContent = balance;
    const currentDateLobbyEl = document.getElementById('currentDateLobby');
    if(currentDateLobbyEl) currentDateLobbyEl.textContent = new Date().toLocaleDateString();

    // tab switching
    tabs.forEach(t=>t.addEventListener('click',()=>{ switchTab(t.dataset.tab); }));
    function switchTab(name){ tabs.forEach(x=>x.classList.toggle('active', x.dataset.tab===name)); for(const k in sections) sections[k].style.display = (k===name)?'block':'none'; renderAll(); }
    
    function generateId(date){ return `${date}_${Date.now().toString(36).slice(2,8)}`; }

    // create new day (name only here)
    createNewDayBtn.addEventListener('click',()=>{
      const date = newDayDate.value || todayKey;
      if(!date) return alert('Wybierz datƒô.');
      const name = newDayName.value ? newDayName.value.trim() : '';
      const id = generateId(date);
      days[id] = {id, date, name, tasks:[], locked:false, completed:false, created: Date.now()};
      save(LS.DAYS, days);
      currentOpenKey = id;
      switchTab('today');
    });

    // render tasks/day view with stronger animations
    function renderTasks(){
      if(!currentOpenKey){
        tasksArea.innerHTML = '<div class="muted" style="margin-top:8px">Nie wybrano dnia. Wr√≥ƒá do Lobby i wybierz / stw√≥rz dzie≈Ñ ‚ú®</div>';
        dayHeaderName.textContent = '(nie wybrano)';
        openDayLabel.textContent = '(data)';
        taskForm.style.display = 'none';
        Array.from(taskForm.querySelectorAll('input,select,button')).forEach(el=>el.disabled = true);
        lockListBtn.disabled = true; finishDayBtn.disabled = true; if(saveDayStateBtn) saveDayStateBtn.disabled = true; return;
      }

      const day = days[currentOpenKey];
      if(!day){ currentOpenKey = null; renderTasks(); return; }

      dayHeaderName.textContent = day.name || day.date;
      openDayLabel.textContent = day.date + (day.completed ? ' ‚Ä¢ uko≈Ñczony' : (day.locked ? ' ‚Ä¢ zamkniƒôta' : ''));

      const isCompleted = !!day.completed;
      const canEdit = !day.locked && !isCompleted;
      const canCheck = !isCompleted;

      taskForm.style.display = canEdit ? 'block' : 'none';
      Array.from(taskForm.querySelectorAll('input,select,button')).forEach(el=>el.disabled = !canEdit);
      lockListBtn.disabled = day.locked || isCompleted;
      finishDayBtn.disabled = isCompleted;
      if(saveDayStateBtn) saveDayStateBtn.disabled = isCompleted;

      tasksArea.innerHTML = '';
      if(!day.tasks.length){ tasksArea.innerHTML = '<div class="muted" style="margin-top:8px">Brak zada≈Ñ. Dodaj nowe ‚ú®</div>'; return; }

      day.tasks.forEach((task,idx)=>{
        const el = document.createElement('div'); el.className='task animate-ultra'; el.style.animationDelay = (idx*80)+'ms';
        const meta = document.createElement('div'); meta.className='meta';
        const b = document.createElement('b'); b.textContent = task.title;
        const tags = document.createElement('div'); tags.className='tags'; tags.innerHTML = `${formatCategory(task.category)} ‚Ä¢ ${task.start}‚Äì${task.end} ‚Ä¢ ${computeTaskCoins(task)} ü™ô`;
        meta.appendChild(b); meta.appendChild(tags);

        const actions = document.createElement('div'); actions.className='actions';
        const cb = document.createElement('input'); cb.type = 'checkbox'; cb.checked = !!task.completed; cb.disabled = !canCheck; cb.addEventListener('change',()=>{ task.completed = cb.checked; save(LS.DAYS,days); renderTasks(); });
        const time = document.createElement('div'); time.className='time'; time.textContent = `${task.start}‚Äì${task.end}`;

        if(!day.locked && !isCompleted){ const del = document.createElement('button'); del.type='button'; del.className='btn secondary small'; del.textContent='üóë'; del.addEventListener('click',()=>{ if(confirm('Usu≈Ñ zadanie?')){ day.tasks = day.tasks.filter(t=>t.id!==task.id); save(LS.DAYS,days); renderTasks(); } }); actions.appendChild(del); }

        actions.appendChild(cb);
        el.appendChild(meta); el.appendChild(time); el.appendChild(actions); tasksArea.appendChild(el);
      });
    }

    // add task
    taskForm.addEventListener('submit',e=>{ e.preventDefault(); if(!currentOpenKey) return alert('Najpierw wybierz lub utw√≥rz dzie≈Ñ.'); const day = days[currentOpenKey]; if(day.locked || day.completed) return alert('Nie mo≈ºna dodawaƒá zada≈Ñ do zamkniƒôtej/uko≈Ñczonej listy.'); const title = titleIn.value.trim(); const start = startIn.value; const end = endIn.value; const category = catIn.value; if(!title||!start||!end) return alert('Wype≈Çnij tytu≈Ç i godziny.'); const id = Date.now().toString(36)+Math.random().toString(36).slice(2,6); const task = {id,title,start,end,category,completed:false}; day.tasks.push(task); save(LS.DAYS,days); titleIn.value=''; startIn.value=''; endIn.value=''; renderTasks(); });

    // save day state (simple save)
    if(saveDayStateBtn) saveDayStateBtn.addEventListener('click',()=>{ if(!currentOpenKey) return alert('Brak wybranego dnia.'); save(LS.DAYS,days); alert('Zapisano.'); });

    // lock list
    lockListBtn.addEventListener('click',()=>{ if(!currentOpenKey) return alert('Brak wybranego dnia.'); const day = days[currentOpenKey]; if(day.locked) return alert('Lista ju≈º zako≈Ñczona.'); if(!day.tasks.length) return alert('Brak zada≈Ñ.'); if(!confirm('ZamknƒÖƒá listƒô na ten dzie≈Ñ?')) return; day.locked = true; save(LS.DAYS,days); renderAll(); alert('Lista zamkniƒôta ‚Äî opcja dodawania zniknƒô≈Ça.'); });

    // finish day
    finishDayBtn.addEventListener('click',()=>{ if(!currentOpenKey) return alert('Brak wybranego dnia.'); const day = days[currentOpenKey]; if(day.completed) return alert('Dzie≈Ñ ju≈º zako≈Ñczony.'); if(!day.tasks.length) return alert('Brak zada≈Ñ.'); let earned = 0; day.tasks.forEach(t=>{ if(t.completed) earned += computeTaskCoins(t); else earned -= 1; }); if(confirm(`Zako≈Ñczyƒá dzie≈Ñ? Bilans: ${earned} monet (niezrobione: -1 ka≈ºda).`)){ balance += earned; day.completed = true; day.locked = true; day.earned = earned; save(LS.DAYS,days); localStorage.setItem(LS.BAL,balance); currentOpenKey = null; renderAll(); alert('Dzie≈Ñ zako≈Ñczony ‚Äî bilans monet: '+earned+' (mo≈ºesz go podejrzeƒá w historii).'); } });

    // --- shop (prices kept as before) ---
    const shopItems = [
      {name:'Paczka z Temu ‚Äî 60 z≈Ç', price:225, desc:'Mi≈Çy prezent'},
      {name:'Paczka Allegro (‚â§40 z≈Ç)', price:150, desc:'Niespodzianka z Allegro'},
      {name:'Paczka z Temu ‚Äî 100 z≈Ç', price:375, desc:'Wiƒôksza nagroda'},
      {name:'Paczka z Temu ‚Äî 200 z≈Ç', price:720, desc:'Du≈ºy prezent'},
      {name:'Paczka Allegro (‚â§100 z≈Ç)', price:300, desc:'≈örednia paczka'}
    ];

    function renderShop(){ shopList.innerHTML=''; shopItems.forEach((it,idx)=>{ const el = document.createElement('div'); el.className='shop-item animate-ultra'; el.style.animationDelay = (idx*80)+'ms'; el.innerHTML = `<div><div style="font-weight:700">${it.name} <span class='muted' style='font-weight:400'>- ${it.price} ü™ô</span></div><div style='font-size:13px' class='muted'>${it.desc}</div></div>`; const btn = document.createElement('button'); btn.type='button'; btn.className='btn'; btn.textContent='Kup'; btn.addEventListener('click',()=>{ if(balance < it.price) return alert('Za ma≈Ço monet.'); if(confirm(`Kupujesz ${it.name} za ${it.price} monet?`)){ balance -= it.price; localStorage.setItem(LS.BAL,balance); const record = {id:Date.now(),name:it.name,price:it.price,date:new Date().toLocaleString()}; purchases.unshift(record); save(LS.PUR,purchases); renderAll(); alert('Zakup zapisany.'); } }); el.appendChild(btn); shopList.appendChild(el); }); }

    function renderPurchases(){ purchasesEl.innerHTML=''; if(!purchases.length){ purchasesEl.innerHTML = '<div class="muted">Brak zakup√≥w.</div>'; return; } purchases.forEach((p,idx)=>{ const el = document.createElement('div'); el.className='animate-ultra'; el.style.animationDelay = (idx*60)+'ms'; el.style.padding='8px'; el.style.borderBottom='1px dashed rgba(0,0,0,0.06)'; el.innerHTML = `<div style='font-size:14px'>${p.name} <span class='muted' style='font-size:12px'>- ${p.price} ü™ô</span></div><div style='font-size:12px' class='muted'>${p.date}</div>`; purchasesEl.appendChild(el); }); }

    // --- history ---
    function renderHistory(){ historyEl.innerHTML=''; const all = Object.entries(days).map(([id,d])=>({id,...d})).sort((a,b)=>b.date.localeCompare(a.date) || (b.created||0)-(a.created||0)); document.getElementById('completedDaysCount').textContent = all.filter(d=>d.completed).length; all.forEach((d,idx)=>{ const el = document.createElement('div'); el.className='history-item animate-ultra'; el.style.animationDelay = (idx*60)+'ms';
        const left = document.createElement('div'); left.className='left';
        const nameEl = document.createElement('div'); nameEl.className='name'; nameEl.textContent = d.name || d.date;
        const dateEl = document.createElement('div'); dateEl.className='date'; dateEl.textContent = d.date;
        const comp = (d.tasks||[]).filter(t=>t.completed).length;
        const un = (d.tasks||[]).length - comp;
        const counts = document.createElement('div'); counts.className='counts'; counts.textContent = `uko≈Ñczone: ${comp} ‚Ä¢ nieuko≈Ñczone: ${un}`;
        left.appendChild(nameEl); left.appendChild(dateEl); left.appendChild(counts);

        const actions = document.createElement('div'); actions.style.display='flex'; actions.style.gap='8px';
        const openBtn = document.createElement('button'); openBtn.type='button'; openBtn.className='btn small'; openBtn.textContent = d.completed ? 'Podejrzyj' : 'Otw√≥rz';
        openBtn.addEventListener('click',()=>{ currentOpenKey = d.id; switchTab('today'); });
        const delBtn = document.createElement('button'); delBtn.type='button'; delBtn.className='btn small secondary'; delBtn.textContent='Usu≈Ñ'; delBtn.addEventListener('click',(ev)=>{ ev.stopPropagation(); if(!confirm('Na pewno usunƒÖƒá ten dzie≈Ñ i wszystkie jego dane?')) return; delete days[d.id]; save(LS.DAYS,days); if(currentOpenKey === d.id){ currentOpenKey = null; switchTab('lobby'); } renderAll(); });
        actions.appendChild(openBtn); actions.appendChild(delBtn);

        el.appendChild(left); el.appendChild(actions); historyEl.appendChild(el);
      }); }

    // quick days
    function renderQuickDays(){ quickDays.innerHTML=''; const all = Object.entries(days).map(([id,d])=>({id,...d})).sort((a,b)=> (b.created||0)-(a.created||0)).slice(0,12); all.forEach((d,idx)=>{ const el = document.createElement('div'); el.className='quick-card animate-ultra'; el.style.animationDelay = (idx*40)+'ms'; el.innerHTML = `<div style='font-weight:700'>${d.name || d.date}</div><div class='date'>${d.date} ${d.completed? '‚Ä¢ uko≈Ñczony':''}</div><div class='muted' style='margin-top:8px'>Zada≈Ñ: ${(d.tasks||[]).length} ‚Ä¢ uko≈Ñczone: ${(d.tasks||[]).filter(t=>t.completed).length}</div>`; const open = document.createElement('button'); open.type='button'; open.className='btn small'; open.textContent = d.completed? 'Podejrzyj' : 'Otw√≥rz'; open.addEventListener('click',()=>{ currentOpenKey = d.id; switchTab('today'); }); el.appendChild(open); quickDays.appendChild(el); }); }

    // helpers & stats
    function timeToMinutes(t){ const [h,m]=t.split(':').map(Number); return h*60+m; }
    function computeTaskCoins(task){ const cat=task.category; if(cat==='inne') return 0; if(task.start && task.end){ let s=timeToMinutes(task.start); let e=timeToMinutes(task.end); let mins = e - s; if(mins<=0) mins = 60; const hours = mins/60; if(cat==='nauka') return Math.max(1, Math.round(hours*3)); if(cat==='sprzatanie') return 2; return 1; } return 1; }
    function formatCategory(c){ if(c==='nauka') return 'üìö Nauka'; if(c==='sprzatanie') return 'üßπ SprzƒÖtanie'; if(c==='poranna') return 'üåÖ Poranna'; if(c==='czas_wolny') return 'üéÆ Czas wolny'; if(c==='inne') return 'üîñ Inne'; return c; }
    function renderStats(){ const all = Object.values(days); statDaysEl.textContent = all.filter(d=>d.completed).length; statCoinsEl.textContent = balance; balanceValEl.textContent = balance; }

    // render everything
    function renderAll(){ save(LS.DAYS,days); localStorage.setItem(LS.BAL,balance); save(LS.PUR,purchases); document.getElementById('balanceVal').textContent = balance; renderTasks(); renderShop(); renderPurchases(); renderHistory(); renderQuickDays(); renderStats(); }

    // initial render
    renderAll();

    // persist on unload
    window.addEventListener('beforeunload',()=>{ save(LS.DAYS,days); localStorage.setItem(LS.BAL,balance); save(LS.PUR,purchases); });

    // debug
    window.Motywator = {days, balance, purchases};
  </script>
</body>
</html>
